$(function($){windowInFocus();getMessagesInfo("#header_messages")});var Cookie={set:function(name,value,expiredays,path,callback){var exdate=new Date;exdate.setDate(exdate.getDate()+expiredays);document.cookie=name+"="+escape(value)+(expiredays==null?"":";expires="+exdate.toGMTString())+";"+(path==null?"":"path="+escape(path));if(typeof callback=="function"){callback&&callback()}},del:function(name,callback){var exp=new Date;exp.setTime(exp.getTime()-1);var cval=getCookie(name);if(cval!=null){document.cookie=name+"="+cval+";expires="+exp.toGMTString()}if(typeof callback=="function"){callback&&callback()}},get:function(name,callback){if(document.cookie.length>0){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");if(arr=document.cookie.match(reg))return arr[2];else return null}if(typeof callback=="function"){callback&&callback()}}};var WINDOWFOCUS=true;function windowInFocus(){$(window).on("focus",function(){WINDOWFOCUS=true});$(window).on("blur",function(){WINDOWFOCUS=false});return true}function getMessagesInfo(selector){if(!selector){return}else if(typeof selector!="string"){console.log("The parameters of 'selector''s type must be a string.");return}var cookieValue=Cookie.get("logininfo");var getMessages=function(){var newMessage=0;$.post(contextPath+"/api/message/getNotice?query_type=1",function(datas){var data=eval(datas);if(data.error_code==0){$("#header_image_url").attr("src",data.image_url);$("#header_username").html(data.name);$("#id_center").show();if(data.other_count>0){newMessage=data.other_count;$(selector).addClass("active");$(".message_count").find("span").text(data.other_count).end().show()}else if(data.other_count=="0"){$(selector).removeClass("active");$(".message_count ").hide().find("span").text("");$(".message_tip").hide().find(".count").text("")}if(data.count>"0"){var timer=setTimeout(function(){$(".message_tip").hide();clearTimeout(timer)},5e3);if(!WINDOWFOCUS){messageNotification("快收单","您有"+data.count+"条待处理事项",contextPath+"/home",contextPath+"/static/icon/kuaisd_m_logo.png")}}}else if(data.error_code==800||data.error_code==1e3||data.error_code==802||data.error_code==804){alert("登录失效，请重新登录");window.location.href=contextPath+"/login/logout"}else{console.log(data.error_msg)}});return newMessage};getMessages();setInterval(function(){getMessages()},3e5)}function messageNotification(title,showDetailInfo,href,icon){if(!!title){if(typeof title!="string"){throw new Error("The parameter of 'title''s type must be a string.");return}}else{throw new Error("The parameter of 'title' is not defined.")}if(!!showDetailInfo){if(typeof showDetailInfo!="string"){throw new Error("The parameter of 'showDetailInfo''s type must be a string.");return}}else{throw new Error("The parameter of 'showDetailInfo' is not defined.")}if(!!href){if(typeof href!="string"){throw new Error("The parameter of 'href''s type must be a string.");return}}else{throw new Error("The parameter of 'href' is not defined.")}if(!!icon){if(typeof icon!="string"){throw new Error("The parameter of 'icon''s type must be a string.");return}}else{throw new Error("The parameter of 'icon' is not defined.")}var NotificationHandler={isNotificationSupported:"Notification"in window,isPermissionGranted:function(){return Notification.permission==="granted"},requestPermission:function(){if(!this.isNotificationSupported){alert("该浏览器目前不支持消息推送，请更换Chrome浏览器打开");return}Notification.requestPermission(function(status){})},showNotification:function(){if(!this.isNotificationSupported){alert("该浏览器目前不支持消息推送，请更换Chrome浏览器打开");return}if(!this.isPermissionGranted()){this.requestPermission()}var n=new Notification(title,{tag:1,renotify:true,requireInteraction:true,icon:icon,body:showDetailInfo});n.onclick=function(){window.location.href=href;n.close()};n.onerror=function(){console.log("Notification encounters an error.")}}};return NotificationHandler.showNotification()}function bindEvents(type,selector,callback){if(!type||!selector){console.log("The parameters of 'type' or 'selector' is not defined.");return false}else{if(typeof type!="string"){console.log("The parameters of 'selector''s type must be a string.");return false}if(typeof selector!="string"){console.log("The parameters of 'selector''s type must be a string.");return false}}if(!!callback&&typeof callback!="function"){console.log("The parameters of 'callback' is not defined or it's type is not a function.")}var ele=$(selector);ele.off(type).on(type,function(e){var e=e||window.event;callback&&callback(e)})}function pageJump(selector,opt){var options={};if(opt){options=$.extend({},opt)}var btn=$(selector);btn.off("click").on("click",function(){var target=$(this);var financeId=$.trim(target.data("id"));var workflowId=$.trim(target.data("flow_id"));var advanceId=$.trim(target.data("advance_id"));var url=$.trim(target.data("url"));financeId&&(options.finance_id=financeId);workflowId&&(options.id=workflowId);advanceId&&(options.advance_id=advanceId);locationTo({action:url,param:options})})}function viewLargeImage(selector){var selectorName=selector||"#viewerImageList";var galley=$(selectorName);galley.each(function(i,t){var imgItem=$(this).find("img");if(imgItem.length>0){var viewer=new Viewer(t,{url:"data-original",interval:2e3,loop:true,toolbar:{zoomIn:true,zoomOut:true,oneToOne:true,reset:true,prev:function(){viewer.prev(true)},play:true,next:function(){viewer.next(true)},rotateLeft:true,rotateRight:true,flipHorizontal:true,flipVertical:true,download:function(){var a=document.createElement("a");a.href=viewer.image.src;a.download=viewer.image.alt;document.body.appendChild(a);a.click();document.body.removeChild(a)}}})}})}Array.prototype.indexOf=function(val){for(var i=0;i<this.length;i++){if(this[i]==val)return i}return-1};Array.prototype.remove=function(val){var index=this.indexOf(val);if(index>-1){this.splice(index,1)}};String.prototype.number=function(){return Number(this)};String.prototype.trim=function(){return $.trim(this)};Number.prototype.number=function(){return Number(this)};var MAXINTEGER=7;function checkMoney(obj){obj.value=obj.value.replace(/[^\d.]/g,"");obj.value=obj.value.replace(/\.{2,}/g,".");obj.value=obj.value.replace(/^\./g,"");obj.value=obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");obj.value=obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3");if(obj.value.indexOf(".")<0&&obj.value!=""){obj.value=parseFloat(obj.value)}if(obj.value>9999999.99){obj.value=obj.value.slice(0,MAXINTEGER);return}}