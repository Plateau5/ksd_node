var RESETPHOTO=false;function uploadPhoto(ele){ele.off("click").on("click",function(){$("#upload_photo_file").click()})}uploadPhoto($(".choose_img"));$(".large_photo>img").cropper({zoomable:true,viewMode:1,preview:"#small_photo",aspectRatio:1,autoCropArea:.8,modal:false});$("#upload_photo_file").on("change",function(){var file=this.files[0];var reader=new FileReader;reader.onload=function(){var url=reader.result;$(".large_photo>img").cropper("reset",true).cropper("replace",url)};reader.readAsDataURL(file);$("#upload_photo_dialog").show();$(".mask").show()});$(".btn_box .cancel_upload").off("click").on("click",function(){$("#upload_photo_dialog").hide();$(".mask").hide()});$(".btn_box .submit_upload").off("click").on("click",function(){$("#upload_photo_dialog").hide();$(".mask").hide();var canVas=$(".large_photo>img").cropper("getCroppedCanvas",{});$("#user_photo").attr("src",canVas.toDataURL());RESETPHOTO=true;var file=$("#user_photo").attr("src").slice(22);var form=new FormData;form.append("file",file);$.ajax({type:"post",timeout:2e4,url:contextPath+"/api/file/base64/upload",data:form,processData:false,contentType:false,beforeSend:function(){$("#loading").show()},success:function(res){$("#loading").hide();if(res.error_code==0){$(".teacher_img").val(res.data[0].image_url)}else{$alert(res.error_msg)}},error:function(){$("#loading").hide();$alert("上传失败，请稍后重试")}})});