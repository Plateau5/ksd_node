var RESETPHOTO=false;function uploadPhoto(ele){ele.off("click").on("click",function(){$("#upload_photo_file").click()})}uploadPhoto($(".choose_img"));$("#upload_photo_file").on("change",function(){var file=this.files[0];var file_type=file.type.split("/")[1];if(file_type=="jpg"||file_type=="jpeg"||file_type=="png"||file_type=="gif"){}else{$alert("上传的图片格式不正确，仅支持JPG、PNG、GIF图片文件");return}var file_size5M=1024*1024*5;if(file.size>file_size5M){$alert("上传的图片大小不可大于5M");return}var reader=new FileReader;reader.onload=function(){var url=reader.result;$(".large_photo>img").cropper("reset",true).cropper("replace",url)};reader.readAsDataURL(file);$("#upload_photo_dialog").show();$(".mask").show()});$(".btn_box .cancel_upload").off("click").on("click",function(){$("#upload_photo_file").val("");$("#upload_photo_dialog").hide();$(".mask").hide()});$(".btn_box .submit_upload").off("click").on("click",function(){var _this=$(this);$("#upload_photo_file").val("");$("#upload_photo_dialog").hide();$(".mask").hide();if($(".upload_btn_mask").length!=0){$(".upload_btn_mask").show()}var canVas=$(".large_photo>img").cropper("getCroppedCanvas",{});$("#user_photo").attr("src",canVas.toDataURL());RESETPHOTO=true;var file=$("#user_photo").attr("src").slice(22);if(file==""){$(".teacher_img").val("");if(_this.hasClass("course_icon")){$("#user_photo").attr("src","/ksd/static/img/create_course.png");$(".upload_btn_mask").hide()}else{$("#user_photo").attr("src","/ksd/static/img/personIcon.png")}return false}var form=new FormData;form.append("file",file);$.ajax({type:"post",timeout:2e4,url:contextPath+"/api/file/base64/upload",data:form,processData:false,contentType:false,beforeSend:function(){$("#loading").show()},success:function(res){$("#loading").hide();if(res.error_code==0){$(".teacher_img").val(res.data[0].image_url)}else{$alert(res.error_msg)}},error:function(){$("#loading").hide();$alert("上传失败，请稍后重试")}})});