<!DOCTYPE html>
<html lang="en">
<head>
    {{include ("./../inc/cssSources")}}
    <link rel="stylesheet" href="{{markUri}}/static/dialog/dialog-layer.css">
    <link rel="stylesheet" href="{{markUri}}/static/css/customerService.css">
    <title>{{title}}</title>
</head>
<body>
<div id="wrapper" class="wrapper">
    <!-------- Part of header Begin -------->
    {{include ('./../inc/header')}}
    <!-------- Part of header End -------->

    <!-------- Part of main Begin -------->
    <div id="section" class="section normal_width">
        <!---- Part of slide nav Begin ---->
        {{include ('./../inc/sideNav')}}
        <!---- Part of slide nav End ---->

        <!---- Part of Main info Begin ---->
        <div id="main" class="main">
            <div class="crumbs_nav">
                <a href="javascript:;" class="crumbs_item">材料管理</a>
                <a href="javascript:;" class="crumbs_item">王磊</a>
                <a href="javascript:;" class="crumbs_item">查看资料</a>
                <div class="new_btn_box rf" id="createOrg" style="display:inline-block;">
                    <a href="javascript:"  class="btn blue_btn add_btn"><em></em>新建机构</a>
                </div>
            </div>
            <!--作为机构分页加载使用-->
            <form action="/organization/list" method="post" id="form_search" role='form'>
            </form>
            <!--作为机构产品列表显示跳转用-->
            <form action="/organization/product/publishList" method="post" id="form_search_product" role='form'>
                <input type="hidden" name="parent_id" id="parent_id" value="" >
            </form>
            <div class="org_list">
                <div class="org_item inline_block org_bg_c1">
                    <div class="org_info">
                        <div class="org_logo inline_block">
                            <img class="img_responsive" src="" alt="">
                        </div>
                        <div class="org_name">先锋太盟</div>
                        <div class="website_url">http://www.baidu.com</a></div>
                    </div>
                    <div class="org_business">
                        <span class="business_type">适用业务：新车/二手车</span>
                        <span class="products_count rf">产品数：10个</span>
                    </div>
                    <div class="org_mask">
                        <a href="javascript:;" class="icon_btn inline_block view_org"></a>
                        <a href="javascript:;" class="icon_btn inline_block view_products"></a>
                        <a href="javascript:;" class="icon_btn inline_block delete_org"></a>
                    </div>
                </div>
                <div class="org_item inline_block org_bg_c2">
                    <div class="org_info">
                        <div class="org_logo inline_block">
                            <img class="img_responsive" src="" alt="">
                        </div>
                        <div class="org_name">先锋太盟</div>
                        <div class="website_url">http://www.baidu.com</a></div>
                    </div>
                    <div class="org_business">
                        <span class="business_type">适用业务：新车/二手车</span>
                        <span class="products_count rf">产品数：10个</span>
                    </div>
                    <div class="org_mask">
                        <a href="javascript:;" class="icon_btn inline_block view_org"></a>
                        <a href="javascript:;" class="icon_btn inline_block view_products"></a>
                        <a href="javascript:;" class="icon_btn inline_block delete_org"></a>
                    </div>
                </div>
                <div class="org_item inline_block org_bg_c3">
                    <div class="org_info">
                        <div class="org_logo inline_block">
                            <img class="img_responsive" src="" alt="">
                        </div>
                        <div class="org_name">先锋太盟</div>
                        <div class="website_url">http://www.baidu.com</a></div>
                    </div>
                    <div class="org_business">
                        <span class="business_type">适用业务：新车/二手车</span>
                        <span class="products_count rf">产品数：10个</span>
                    </div>
                    <div class="org_mask">
                        <a href="javascript:;" class="icon_btn inline_block view_org"></a>
                        <a href="javascript:;" class="icon_btn inline_block view_products"></a>
                        <a href="javascript:;" class="icon_btn inline_block delete_org"></a>
                    </div>
                </div>
                <div class="org_item inline_block org_bg_c4">
                    <div class="org_info">
                        <div class="org_logo inline_block">
                            <img class="img_responsive" src="" alt="">
                        </div>
                        <div class="org_name">先锋太盟</div>
                        <div class="website_url">http://www.baidu.com</a></div>
                    </div>
                    <div class="org_business">
                        <span class="business_type">适用业务：新车/二手车</span>
                        <span class="products_count rf">产品数：10个</span>
                    </div>
                    <div class="org_mask">
                        <a href="javascript:;" class="icon_btn inline_block view_org"></a>
                        <a href="javascript:;" class="icon_btn inline_block view_products"></a>
                        <a href="javascript:;" class="icon_btn inline_block delete_org"></a>
                    </div>
                </div>
                <div class="org_item inline_block org_bg_c5">
                    <div class="org_info">
                        <div class="org_logo inline_block">
                            <img class="img_responsive" src="" alt="">
                        </div>
                        <div class="org_name">先锋太盟</div>
                        <div class="website_url">http://www.baidu.com</a></div>
                    </div>
                    <div class="org_business">
                        <span class="business_type">适用业务：新车/二手车</span>
                        <span class="products_count rf">产品数：10个</span>
                    </div>
                    <div class="org_mask">
                        <a href="javascript:;" class="icon_btn inline_block view_org"></a>
                        <a href="javascript:;" class="icon_btn inline_block view_products"></a>
                        <a href="javascript:;" class="icon_btn inline_block delete_org"></a>
                    </div>
                </div>
                <div class="org_item inline_block org_bg_c6">
                    <div class="org_info">
                        <div class="org_logo inline_block">
                            <img class="img_responsive" src="" alt="">
                        </div>
                        <div class="org_name">先锋太盟</div>
                        <div class="website_url">http://www.baidu.com</a></div>
                    </div>
                    <div class="org_business">
                        <span class="business_type">适用业务：新车/二手车</span>
                        <span class="products_count rf">产品数：10个</span>
                    </div>
                    <div class="org_mask">
                        <a href="javascript:;" class="icon_btn inline_block view_org"></a>
                        <a href="javascript:;" class="icon_btn inline_block view_products"></a>
                        <a href="javascript:;" class="icon_btn inline_block delete_org"></a>
                    </div>
                </div>
                <div class="org_item inline_block org_bg_c7">
                    <div class="org_info">
                        <div class="org_logo inline_block">
                            <img class="img_responsive" src="" alt="">
                        </div>
                        <div class="org_name">先锋太盟</div>
                        <div class="website_url">http://www.baidu.com</a></div>
                    </div>
                    <div class="org_business">
                        <span class="business_type">适用业务：新车/二手车</span>
                        <span class="products_count rf">产品数：10个</span>
                    </div>
                    <div class="org_mask">
                        <a href="javascript:;" class="icon_btn inline_block view_org"></a>
                        <a href="javascript:;" class="icon_btn inline_block view_products"></a>
                        <a href="javascript:;" class="icon_btn inline_block delete_org"></a>
                    </div>
                </div>
                <div class="org_item inline_block org_bg_c8">
                    <div class="org_info">
                        <div class="org_logo inline_block">
                            <img class="img_responsive" src="" alt="">
                        </div>
                        <div class="org_name">先锋太盟</div>
                        <div class="website_url">http://www.baidu.com</a></div>
                    </div>
                    <div class="org_business">
                        <span class="business_type">适用业务：新车/二手车</span>
                        <span class="products_count rf">产品数：10个</span>
                    </div>
                    <div class="org_mask">
                        <a href="javascript:;" class="icon_btn inline_block"></a>
                        <a href="javascript:;" class="icon_btn inline_block"></a>
                        <a href="javascript:;" class="icon_btn inline_block"></a>
                    </div>
                </div>
                <div class="org_item inline_block org_bg_c9">
                    <div class="org_info">
                        <div class="org_logo inline_block">
                            <img class="img_responsive" src="" alt="">
                        </div>
                        <div class="org_name">先锋太盟</div>
                        <div class="website_url">http://www.baidu.com</a></div>
                    </div>
                    <div class="org_business">
                        <span class="business_type">适用业务：新车/二手车</span>
                        <span class="products_count rf">产品数：10个</span>
                    </div>
                    <div class="org_mask">
                        <a href="javascript:;" class="icon_btn inline_block view_org"></a>
                        <a href="javascript:;" class="icon_btn inline_block view_products"></a>
                        <a href="javascript:;" class="icon_btn inline_block delete_org"></a>
                    </div>
                </div>
            </div>
            {{include('./../inc/pagination')}}

        </div>
        <!---- Part of Main info End ---->
    </div>
    <!-------- Part of main End -------->

    <!-------- Part of footer Begin -------->
    <!--<div id="footer" class="footer"></div>-->
    <!-------- Part of footer End -------->
</div>
<div class="mask" style="display: none;"></div>
</body>
{{include ('./../inc/jsSources')}}
<script src="{{markUri}}/static/js/customerService.js" type="text/javascript" charset="UTF-8"></script>
<script src="{{markUri}}/static/dialog/dialog-layer.js" type="text/javascript" charset="UTF-8"></script>
<script>
    (function ($) {
        //新建机构
        function createOrg () {
            var btn = $("#createOrg, .createOrg");
            btn.off("click").on("click", function () {
                locationTo({
                    action : contextPath + "/organization/toAdd"
                });
            });
        }

        //机构列表鼠标悬停时的动画效果
        function displacementAnimation () {
            var t = $(".org_item");
            t.each(function () {
                var _this = $(this);
                _this.hover(function () {
                    var that = $(this);
                    that.find(".org_mask").show().stop().animate({bottom : "0px"}, 300);
                }, function () {
                    var that = $(this);
                    that.find(".org_mask").stop().animate({bottom : "-60px"}, 300, function () {
                        $(this).hide();
                    });
                })
            });
        }
        //点击产品编辑按钮后的跳转逻辑
        function showOrgProducts () {
            var btn = $(".org_mask .view_products");
            var form = $("#form_search_product");
            var input = form.find("#parent_id");
            btn.off("click").on("click", function () {
                var href = $.trim($(this).parents('.org_mask').attr("lang"));
                input.val(href);
                form.submit();
            })
        }

        //删除机构按钮的点击事件
        function deleteOrg () {
            var delBtn = $(".delete_org");
            delBtn.each(function () {
                var t = $(this);
                t.off("click").on("click", function () {
                    var orgId = $.trim($(this).parents('.org_mask').attr("lang"));
                    var data = {
                        id : orgId
                    };
                    dialog('open', {
                        title : '删除提醒',
                        content : '<div style="padding: 40px 0 20px;line-height:30px;"><span style="color: #808692;font-size: 14px;">删除后此机构下的产品也将删除，删除后将不可恢复，</span><br><span>确认继续删除？</span></div>',
                        onConfirm : function (d) {
                            delConfirm(data, d);
                        }
                    })
                });
            });
            //确定删除
            function delConfirm (datas, d) {
                var data = datas;
                var url  = contextPath + "/api/organization/delete";
                $ajax('post',url, data, function (req) {
                    var res = eval(req);
                    if (res.error_code == 0) {
                        d.close();
                        $alert('删除成功', function () {
                            window.location.reload();
                        });
                    }
                }, function () {
                    d.close();
                    $alert('删除失败，请稍后重试');
                });
            }
        }

        //跳转机构详情页
        function goOrgDetail () {
            var btn = $(".org_mask .view_org");
            btn.off("click").on("click", function () {
                var href = $.trim($(this).parents('.org_mask').attr("lang"));
                locationTo({
                    action : contextPath + '/organization/detail',
                    param : {
                        id : href
                    }
                });
            })

        }

        $(function() {
            displacementAnimation();
            showOrgProducts();
            deleteOrg();
            goOrgDetail();
            createOrg();
        });
    })(jQuery, undefined);
</script>
</html>